<!--(If you put it under static, Spring won’t render it via @Controller.)-->
<!--I CANNOT use both of these together: Custom /api/v1/auth/login that returns JWT......sessionStorage, manual redirect
 AND formLogin() in Spring Security
-->
<!--I decided the BEST approach is session-based authentication(session auth). Then the correct setup is to Use Spring Security formLogin. ❌ DO NOT use JWT
❌ DO NOT use sessionStorage
❌ DO NOT use /api/v1/auth/login for browser login
❌ My previous login.html was WRONG (for session auth)
-->

<!--✔ Let Spring Security handle login-->
<!--✔ Automatic redirect-->
<!--✔ Session stored automatically-->

<!--Correct login form fields:-->
<!--name="username"-->
<!--name="password"-->
<!--Spring Security expects:-->
<!--username-->
<!--password-->

<!--Even if I internally treat username as phone.-->
<!--you should not mix two authentication models-->
<!--HTML forms + JWT APIs don’t mix well-->
<!--We are using Spring Security session-based auth for browser-->
<!--If I chose session-based auth (BEST for browser) I should REMOVE / IGNORE JWT for now,
❌ JwtUtil

❌ AuthResponse

❌ /api/v1/auth/login (for browser)

❌ returning JWT to browser I can re-add JWT later for mobile apps-->
<!--Previously I had: /api/v1/auth/login → JWT-based login & formLogin() → Session-based login...These must NOT coexist for browser login-->

<!--Spring Security does NOT know how to load users. I was missing a UserDetailsService.Spring Security does not use my AuthService.login() automatically. It needs: UserDetailsService,, Otherwise:
❌ login will always fail
❌ password matching won’t work-->


<!--Spring Security authenticates using: username, But my database uses: phone.... I must explicitly tell Spring Security: “username == phone” otherwise that mapping will miss-->

<!--Browser login goes through /login handled by Spring Security-->
<!--I'm NOT using /api/v1/auth/login for the browser-->
<!--My /api/v1/auth/login is JWT-based and unsafe (exposes password hash)-->

<!-- HTML should be rendered by Thymeleaf properly-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Login</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!--    Spring Boot will serve style.css automatically.-->
    <link rel="stylesheet" href="/css/style.css">

    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

</head>
<body>
<div id="notif-toast-container"></div>
<button class="dark-toggle" onclick="toggleDark()"> <i class="fa-solid fa-moon"></i></button>

<div class="container">
<h2>Login</h2>
<!--HTML form submission needs a POST handler.-->
<!--<form method="post" action="/login">-->
<!--    <input type="text" name="username" placeholder="Phone" required><br><br>-->
<!--    <input type="password" name="password" placeholder="Password" required><br><br>-->
<!--    <button type="submit">Login</button>-->
<!--</form>-->

<!--   if we don't use CSRF, authentication will fail silently...Spring Security will reject POST (This is because I enabled CSRF.) and Spring Security keeps redirecting back to /login(classic Spring Security redirect loop, Spring Security rejects the POST → redirect loop.) .........if login form does NOT send the CSRF token. This is because I enabled CSRF....login works, session created -->
<form th:action="@{/login}" method="post">
<!--    Spring Security REQUIRES these exact names by default: username, password-->
        <input type="text" name="username" placeholder="Phone" required>
        <input type="password" name="password" placeholder="Password" required>
<!--Add CSRF hidden input to login form-->
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <button type="submit">Login</button>
</form>

<!--    <div th:if="${param.error}" class="error-message">-->
<!--        Invalid phone number or password-->
<!--    </div>-->


<a href="/register">Register</a>

<div th:if="${loginError}" class="error-message">
        <span th:text="${loginError}"></span>
<!--        Thymeleaf allows Security integration so it can work with sessions. This is impossible with static HTML-->
<!--Thymeleaf is used instead of plain HTML because Thymeleaf is a server-side template engine. That means:

It allows you to write HTML that can include dynamic data from your Spring controllers.

It can evaluate expressions like ${loginError} and insert values before sending the page to the browser.

It integrates seamlessly with Spring MVC and Spring Security, making it easy to show user-specific content, error messages, and session-dependent info.

Without Thymeleaf, your HTML would be static, and you would need JavaScript or manual string replacement to insert messages from the server.-->
<!--Integration with Spring Security

Thymeleaf has features to work with the user session, authentication status, roles, etc.Example: You can show different content for logged-in users. But You cannot do this with static HTML because static HTML has no way of knowing who the logged-in user is or what the server says.-->
</div>

    <div id="toast" class="toast"></div>

</div>
<script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>  <!-- define-SockJS -->
<script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script> <!--    define Stomp -->
<script src="/js/app.js"></script> <!--loaded after DOM. Guarantees DOM exists-->
</body>
</html>



<!--Spring Security expects: username, password-->
<!--My login form previously posted to /api/v1/auth/login. That returns JSON, not a page-->
<!--HTML forms cannot handle JWT login properly...JWT must be handled by Javascript-->
<!--We should prevent normal form submit(previous form submit is wrong approach), Use fetch(),save JWT, Redirect manually-->
<!--The form action refers to the action attribute of an HTML form, which defines the URL where the collected form data will be sent for processing when the form is submitted.-->

<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--    <title>Login</title>-->
<!--</head>-->
<!--<body>-->

<!--<h2>Login</h2>-->

<!--<input type="text" id="phone" placeholder="Phone"><br><br>-->
<!--<input type="password" id="password" placeholder="Password"><br><br>-->
<!--<button onclick="login()">Login</button>-->

<!--<p id="error" style="color:red;"></p>-->

<!--<a href="/register">Register</a>-->

<!--<script>-->
<!--    function login() {-->
<!--        const phone = document.getElementById("phone").value;-->
<!--        const password = document.getElementById("password").value;-->

<!--        fetch("/api/v1/auth/login", {-->
<!--            method: "POST",-->
<!--            headers: {-->
<!--                "Content-Type": "application/json"-->
<!--            },-->
<!--            body: JSON.stringify({-->
<!--                phone: phone,-->
<!--                password: password-->
<!--            })-->
<!--        })-->
<!--        .then(res => {-->
<!--            if (!res.ok) throw new Error("Invalid credentials");-->
<!--            return res.json();-->
<!--        })-->
<!--        .then(data => {-->
<!--            // ✅ Store JWT & phone-->
<!--            sessionStorage.setItem("token", data.token);-->
<!--            sessionStorage.setItem("phone", data.user.phone);-->

<!--            // ✅ Redirect-->
<!--            window.location.href = "/dashboard";-->
<!--        })-->
<!--        .catch(err => {-->
<!--            document.getElementById("error").innerText =-->
<!--                "Login failed. Check credentials.";-->
<!--        });-->
<!--    }-->
<!--</script>-->

<!--</body>-->
<!--</html>-->










<!--<!DOCTYPE html>-->
<!--<html>-->
<!--<head>-->
<!--    <title>Login</title>-->
<!--</head>-->
<!--<body>-->

<!--<h2>Login</h2>-->

<!--<form action="/api/v1/auth/login" method="post">-->
<!--&lt;!&ndash;    My login form posts to /api/v1/auth/login. That returns JSON, not a page&ndash;&gt;-->
<!--&lt;!&ndash;    HTML forms cannot handle JWT login properly...JWT must be handled by Javascript&ndash;&gt;-->
<!--&lt;!&ndash;    We should prevent normal form submit(above form submit is wrong approach), Use fetch(),save JWT, Redirect manually&ndash;&gt;-->
<!--&lt;!&ndash;    The form action refers to the action attribute of an HTML form, which defines the URL where the collected form data will be sent for processing when the form is submitted. &ndash;&gt;-->
<!--    <input type="text" name="phone" placeholder="Phone" /><br><br>-->
<!--    <input type="password" name="password" placeholder="Password" /><br><br>-->
<!--    <button type="submit">Login</button>-->
<!--</form>-->

<!--<a href="/register">Register</a>-->

<!--</body>-->
<!--</html>-->


